<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raksha - SOS Shield</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #ffebee; margin: 0; padding: 20px; height: 100vh; display: flex; flex-direction: column; justify-content: center; }
        .btn { width: 100%; padding: 25px; font-size: 22px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 6px 15px rgba(0,0,0,0.3); }
        .btn-orange { background: linear-gradient(135deg, #ef6c00, #ff9800); }
        .guard-active { background: #1a1a1a !important; color: #ff9800 !important; border: 3px solid #ff9800; animation: pulse 1.5s infinite; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0px rgba(239, 108, 0, 0.7);} 100% {box-shadow: 0 0 0 20px rgba(239, 108, 0, 0);} }
        #status { margin-top: 30px; font-weight: bold; font-size: 18px; color: #b71c1c; }
        #remoteTrap { position: absolute; opacity: 0; top: 0; left: 0; width: 1px; height: 1px; }
    </style>
</head>
<body>

    <h2>üõ°Ô∏è Raksha Remote Shield</h2>

    <input type="text" id="remoteTrap" autofocus>

    <button id="guardBtn" class="btn btn-orange" onclick="activateGuard()">
        üîó ACTIVATE GUARD
        <br><span style="font-size:12px; font-weight:normal;">(Press Remote after Tapping)</span>
    </button>

    <div id="status">Status: Waiting...</div>

    <audio id="sosAudio" loop preload="auto">
        <source src="https://www.soundjay.com/buttons/beep-01a.mp3" type="audio/mpeg">
    </audio>

    <script>
        const BOT_TOKEN = "8378037937:AAGjuFdZWLnf0kFfTG_QIFCslgvrDMb-sC4";
        const CHAT_ID = "8508792403";
        
        let isGuardActive = false;
        let sosTriggered = false;
        const audio = document.getElementById('sosAudio');
        const trap = document.getElementById('remoteTrap');

        async function activateGuard() {
            if (isGuardActive) return;
            
            try {
                // 1. Audio Start
                audio.volume = 0.1;
                await audio.play();

                // 2. REMOTE FIX: Agar sound ruka, toh SOS
                audio.addEventListener('pause', () => {
                    if (isGuardActive && !sosTriggered) {
                        triggerSOS("Remote Button (Sound Pause)");
                    }
                });

                // 3. REMOTE FIX: Agar sound ki speed badli (kuch remotes ye karte hain)
                audio.addEventListener('ratechange', () => {
                   if (isGuardActive && !sosTriggered) triggerSOS("Remote Speed Change");
                });

                // 4. Media Session (Standard Remote Control)
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.metadata = new MediaMetadata({ title: 'Raksha Active' });
                    navigator.mediaSession.setActionHandler('play', () => triggerSOS("Media Play"));
                    navigator.mediaSession.setActionHandler('pause', () => triggerSOS("Media Pause"));
                }

                // 5. Input Trap (Key detection)
                trap.focus();
                trap.addEventListener('input', () => triggerSOS("Remote Input"));

                isGuardActive = true;
                document.getElementById('guardBtn').classList.add('guard-active');
                document.getElementById('guardBtn').innerHTML = "üõ°Ô∏è GUARD ACTIVE<br>Press Button to SOS";
                document.getElementById('status').innerText = "üü¢ Scanning for Signal...";
                document.getElementById('status').style.color = "green";

            } catch (err) {
                alert("Please tap again to enable remote.");
            }
        }

        // Window level backup
        window.addEventListener('keydown', (e) => {
            if(isGuardActive) triggerSOS("Key: " + e.key);
        });

        function triggerSOS(source) {
            if (sosTriggered) return;
            sosTriggered = true;

            // Immediate Feedback
            document.body.style.backgroundColor = "black";
            document.getElementById('status').innerText = "üö® SOS TRIGGERED!";
            if (navigator.vibrate) navigator.vibrate([500, 200, 500, 200, 500]);

            // Telegram Alert
            navigator.geolocation.getCurrentPosition(pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                const msg = `üö® SOS ALERT!\nSource: ${source}\nLocation: http://maps.google.com/maps?q=${lat},${lon}`;
                
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}`)
                .then(() => {
                    // Call Emergency
                    window.location.href = "tel:112";
                });
            }, (err) => {
                // Location fail ho toh bina location ke bhejo
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=üö® SOS! Remote Clicked (Location Hidden)`)
                .then(() => window.location.href = "tel:112");
            });
        }
    </script>
</body>
</html>
