<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Raksha - Volume Trigger Fix</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; text-align: center; background-color: #ffebee; padding: 20px; margin: 0; overflow: hidden; height: 100vh; display: flex; flex-direction: column; justify-content: center; }
        .btn { width: 100%; padding: 25px; font-size: 20px; border: none; border-radius: 15px; color: white; font-weight: bold; cursor: pointer; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-orange { background: linear-gradient(135deg, #ef6c00, #ff9800); }
        .guard-active { background: #333 !important; color: #ff9800 !important; border: 3px solid #ff9800; }
        #status { margin-top: 20px; font-weight: bold; color: #b71c1c; font-size: 14px; }
        #rakshak-icon { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; background: white; border-radius: 50%; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; font-size: 30px; z-index: 1000; border: none; cursor: pointer; }
    </style>
</head>
<body>

    <h2>üõ°Ô∏è Raksha Ultimate</h2>
    
    <button id="guardBtn" class="btn btn-orange" onclick="activateVolumeGuard()">
        üîó ACTIVATE REMOTE GUARD
        <br><span style="font-size:12px; font-weight:normal;">(Press Volume Button After Tapping)</span>
    </button>

    <div id="status">üî¥ Guard Offline</div>

    <button id="rakshak-icon" onclick="window.open('https://ultimate-rakshak.vercel.app/', '_blank')">‚ù§Ô∏è</button>

    <script>
        const BOT_TOKEN = "8378037937:AAGjuFdZWLnf0kFfTG_QIFCslgvrDMb-sC4";
        const CHAT_ID = "8508792403";
        
        let isGuardActive = false;
        let initialHeight = window.innerHeight;
        let sosTriggered = false;

        function activateVolumeGuard() {
            if (!isGuardActive) {
                isGuardActive = true;
                initialHeight = window.innerHeight; // Current height save karo
                
                document.getElementById('guardBtn').classList.add('guard-active');
                document.getElementById('guardBtn').innerHTML = "üõ°Ô∏è GUARD ON<br>Click Remote Volume Now";
                document.getElementById('status').innerText = "üü¢ Monitoring Volume Changes...";
                document.getElementById('status').style.color = "green";

                // Technique 1: Resize Detection (Volume bar aane par height badalti hai)
                window.addEventListener('resize', () => {
                    if (isGuardActive && !sosTriggered) {
                        handleSOS();
                    }
                });

                // Technique 2: Media Key Backup
                if ('mediaSession' in navigator) {
                    navigator.mediaSession.setActionHandler('play', handleSOS);
                    navigator.mediaSession.setActionHandler('pause', handleSOS);
                }
                
                // Audio play for Media Session
                let audio = new Audio('https://www.soundjay.com/buttons/beep-01a.mp3');
                audio.volume = 0.1;
                audio.play();
            }
        }

        function handleSOS() {
            if (sosTriggered) return;
            sosTriggered = true;
            
            document.getElementById('status').innerText = "üö® SOS ACTIVATED!";
            document.body.style.backgroundColor = "black";

            // Vibrate
            if (navigator.vibrate) navigator.vibrate([500, 200, 500]);

            // Location
            navigator.geolocation.getCurrentPosition(pos => {
                const lat = pos.coords.latitude;
                const lon = pos.coords.longitude;
                const msg = `üö® SOS TRIGGERED!\nRemote Button Pressed\nLocation: https://www.google.com/maps?q=${lat},${lon}`;
                
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage?chat_id=${CHAT_ID}&text=${encodeURIComponent(msg)}`);
            });

            // Auto-Call 112
            setTimeout(() => {
                window.location.href = "tel:112";
            }, 1500);
        }
    </script>
</body>
</html>
